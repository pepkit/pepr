---
title: "Constants in pepr"
author: "Michal Stolarczyk"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette will show you how and why to use the constants functionality of the `pepr` package. For introductory information about the package visit the [documentation page](http://code.databio.org/pepr/index.html). For the basic information about the PEP concept visit the [project website](https://pepkit.github.io/).

### Problem/Goal
The example below demonstrates how to use the constants to **define the samples attributes in the `read_type` column** of the `sample_annotation.csv` file. This functionality is extremely useful when there are many samples that are characterized by identical values of certain attribute (here: value `SINGLE` in `read_type` attribute). Please consider the example below for reference:

```{r ,echo=FALSE,warning=FALSE}
library(knitr)
sampleAnnotation = system.file(
"extdata",
"example_peps-master",
"example_constants",
"sample_annotation_pre.csv",
package = "pepr"
)
sampleAnnotationDF = read.table(sampleAnnotation, sep = ",", header = T)
knitr::kable(sampleAnnotationDF, format = "html") 
```

----
### Solution
As the name suggests the attributes in the specified attributes (here: `read_type`) can be defined as constant ones. The way how this process is carried out is indicated explicitly in the `project_config.yaml` file (presented below). The name of the column is determined in the `constants` key-value pair. Note that definition of more than one constant attribure is possible.


```{r, echo=FALSE,message=TRUE,collapse=TRUE,comment=" "}
library(pepr)
projectConfig = system.file(
"extdata",
"example_peps-master",
"example_constants",
"project_config.yaml",
package = "pepr"
)
printNestedList(yaml::read_yaml(projectConfig))
```


Let's introduce a few modifications to the original `sample_annotation.csv` file to use the `constants` section of the config. Simply skip the attributes that are set constant and let the `pepr` do the work for you.

```{r ,echo=FALSE,warning=FALSE}
sampleAnnotation = system.file(
  "extdata",
  "example_peps-master",
  "example_constants",
  "sample_annotation.csv",
  package = "pepr"
  )
  sampleAnnotationDF = read.table(sampleAnnotation, sep = ",", header = T)
  kable(sampleAnnotationDF, format = "html") 
```

----
### Code
Load `pepr` and read in the project metadata by specifying the path to the `project_config.yaml`:

```{r}
library(pepr)
projectConfig = system.file(
"extdata",
"example_peps-master",
"example_constants",
"project_config.yaml",
package = "pepr"
)
p = Project(projectConfig)
```

And inspect it:

```{r}
samples(p)
```

As you can see, the resulting samples are annotated the same way as if they were read from the original annotations file with attributes in the last column manually determined.

What is more, the `p` object consists of all the information from the project config file (`project_config.yaml`). Run the following line to explore it:

```{r}
config(p)
```

