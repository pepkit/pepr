---
title: "Derieved columns and Implied columns in `pepr`"
author: "Michal Stolarczyk"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette will show you how and why to use both the derieved and implied columns functionalities of the `pepr` package. For introductory information about the package visit the [documentation page](http://code.databio.org/pepr/index.html). For the basic information about the PEP concept visit the [project website](https://pepkit.github.io/).

## Derived columns

The example below demonstrates how to use the derived columns to simplify and unclutter your `sample_annotation.csv` file (presented below):


```{r ,echo=FALSE}
library(knitr)
library(kableExtra)
sampleAnnotation = system.file("extdata", "example_derived", "sample_annotation_pre.csv", package="pepr")
sampleAnnotationDF=read.table(sampleAnnotation,sep = ",",header = T)
kable(sampleAnnotationDF,format = "html") 
```


As the name suggests the entries in the specified columns can be derived from other ones. The way how this process is carried out is indicated explicitly in the `project_config.yaml` file (presented below):

```{yaml, highlight=TRUE,caption="TEST"}
derived_columns: [file_path]
data_sources:
  source1: /data/lab/project/{sample_name}.fastq
  source2: /path/from/collaborator/weirdNamingScheme_{external_id}.fastq
```

Let's introduce a few modifications to the original `sample_annotation.csv` file to map the appropriate data sources from the `project_config.yaml` with entries in the derived column - `[file_path]`:

```{r ,echo=FALSE}
library(knitr)
library(kableExtra)
sampleAnnotation = system.file("extdata", "example_derived", "sample_annotation.csv", package="pepr")
sampleAnnotationDF=read.table(sampleAnnotation,sep = ",",header = T)
kable(sampleAnnotationDF,format = "html") 
```

Load `pepr` and read in the project by specifying the path to the `project_config.yaml`:

```{r}
library(pepr)
projectConfig = system.file("extdata", "example_derived", "project_config.yaml", package="pepr")
p=Project(projectConfig)
```

And inspect it:

```{r}
p@samples
```

The resulting samples are annotated the same way as if they were read from the original annotations file.




